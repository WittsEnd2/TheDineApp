// Register the callback to be fired every time auth state changes

var myFirebaseRef = new Firebase("https://sweltering-inferno-9361.firebaseio.com/");
var newPostRef = myFirebaseRef.push();
var newRestaurauntRef = myFirebaseRef.child("restaurant").push();
//Creates a new user
function newUserCreate(){
  var userEmail = document.getElementById("userUsername").value;
  var userPassword = document.getElementById("userPassword").value;
  var userEmailConfirm = document.getElementById("userUsernameConfirm").value;
  var userPasswordConfirm = document.getElementById("userPasswordConfirm").value;
  var restaurantName = document.getElementById("restaurant").value;
  var restaurantState = document.getElementById("restaurantState").value;
  var restaurantAddress = document.getElementById("restaurantAddress").value;
  //checks if emails and passwords match
  if (userEmail != userEmailConfirm || userPassword != userPasswordConfirm){
    console.log("Error Creating User: Username and passwords do not match.");
    setTimeout(function(){
      window.location.herf = "registers";
    }, 2000);
  } else {
    console.log(document.getElementById("userUsername").value);
    console.log(document.getElementById("userPassword").value);
    myFirebaseRef.createUser({
      email    : userEmail,
      password : userPassword
    }, function(error, userData) {
      if (error) {
        console.log("Error creating user:", error);
        setTimeout(function(){
          window.location.herf = "register";
        }, 2000);
      } else {
        console.log("Successfully created user account with uid:", userData.uid);
        var usersFirebaseRef = new Firebase("https://sweltering-inferno-9361.firebaseio.com/users");
        usersFirebaseRef.child(userData.uid).set({
          email: userEmail,
          restaurant: restaurantName,
          UserId: userData.uid
        });
        myFirebaseRef.child("restaurant").child(restaurantName).set({
          Name: restaurantName,
          State: restaurantState,
          Address: restaurantAddress
        });
        setTimeout(function(){
          window.location.herf = "login";
        }, 2000);
      }
    });
  }
  // find a suitable name based on the meta info given by each provider
  return false;
}
//Authenticates a new user whenever they want to login to their account.
function userAuthenticate(){
  var userEmail = document.getElementById("userUsername").value;
  var userPassword = document.getElementById("userPassword").value;
  console.log(document.getElementById("userUsername").value);
  console.log(document.getElementById("userPassword").value);
  myFirebaseRef.authWithPassword({
    email : userEmail,
    password : userPassword
  }, function(error, authData){
    if(error){
      console.log("Login Failed!", error);
      setTimeout(function(){
        window.location.href = "login";
      }, 2000);
    } else {
      console.log("Authenticated successfully!", authData);
      setTimeout(function(){
        window.location.href = "dashboard";
      }, 2000);
    }
    remember: "sessionOnly"
  });
  return false;
}
function userLogOut(){
  myFirebaseRef.unAuth();
}
function checkUserAuthentication(){
  var authData = myFirebaseRef.getAuth();
  if (authData) {
    console.log("User " + authData.uid + " is logged in with " + authData.provider);
  } else {
    setTimeout(function(){
      window.location.href = "login";      
    }, 0);
  }
}
